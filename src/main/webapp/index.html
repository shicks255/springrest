<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test The Amazon Purchases Rest Service</title>

    <style>
        table td{
            border : 1px solid black;
            padding: 2px;
        }
    </style>

    <script>

        function searchForId(element)
        {
            var containingBox = document.getElementById('idSearchResponseBox');
            while (containingBox.firstChild)
                containingBox.removeChild(containingBox.firstChild);

            if (isNaN(element.value))
            {
                alert('Must be a numeric value');
                element.value = '';
                return;
            }

            var purchaseId = element.value;
            var xhttp = new XMLHttpRequest();
            xhttp.open("GET", "/purchases/" + purchaseId, true);
            xhttp.send();
            xhttp.onreadystatechange = function()
            {
                if (this.readyState == 4 && this.status == 200)
                {
                    var purchase = JSON.parse(xhttp.responseText);
                    if (purchase)
                        createTable(purchase);
                }
                else if (this.readyState === 4 && this.status !== 200)
                {
                    var error = document.createElement('div');
                    error.innerText = 'Something went wrong, try again';
                    containingBox.appendChild(error);
                }
            }
        }

        function searchForText(element)
        {
            var searchTerms = element.value;

            var xhhtp = new XMLHttpRequest();
            xhhtp.onreadystatechange = function()
            {
                if (this.readyState == 4 && this.status == 200)
                {

                }
            };
            xhhtp.open("GET", "/purchases/search?searchTerms=" + searchTerms);
            xhhtp.send();
        }

        function createTable(purchase)
        {
            var form = document.createElement("form");
            var table = document.createElement("table");

            for (i in purchase)
            {
                var tr = document.createElement('tr');
                var td1 = document.createElement('td');
                var td2 = document.createElement('td');

                var input = document.createElement('input');
                input.setAttribute("type", "text");
                input.setAttribute("name", i);
                input.setAttribute("id", i);
                input.setAttribute("value", purchase[i]);
                if (i === 'objectId')
                    input.setAttribute('readOnly', true);

                var text = document.createTextNode(i);
                var text2 = document.createTextNode(purchase[i]);

                input.appendChild(text2)
                td2.appendChild(input);
                td1.appendChild(text);
                tr.appendChild(td1);
                tr.appendChild(td2);
                table.appendChild(tr);
            }

            var editButton = document.createElement('button');
            editButton.innerText = 'Update';
            editButton.onclick = () =>
            {
                var http = new XMLHttpRequest();
                http.open('POST', '/purchases/' + purchase['objectId']);
                http.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

                var pairs = [];
                for (i in purchase)
                    pairs.push(encodeURIComponent(i) + '=' + encodeURIComponent(document.getElementById(i).value));

                var data = pairs.join('&').replace('/%20/g', '+');
                http.send(data);
            };

            var deleteButton = document.createElement('button');
            deleteButton.innerText = 'Delete';
            deleteButton.onclick = () =>
            {
                var http = new XMLHttpRequest();
                http.open('DELETE', '/purchases/' + purchase['objectId']);
                http.send();

                location.reload();
            };

            var clearButton = document.createElement('button');
            clearButton.innerText = 'Reset';
            clearButton.onclick = () => location.reload();

            var box = document.getElementById('idSearchResponseBox');

            form.appendChild(table);
            box.appendChild(form);
            box.appendChild(editButton);
            box.appendChild(deleteButton);
            box.appendChild(clearButton);
        }

    </script>
</head>
<body>


<label for="idSearch">Search for a Purchase</label>
<br/>
<input type="text" name="idSearch" id="idSearch" placeholder="Enter an Object Id">
<button value="Search" id="searchForIdButton" name="searchForIdButton" onclick="searchForId(this.previousElementSibling);">Search</button>
<div id="idSearchResponseBox" name="idSearchResponseBox"></div>
<hr>

<label for="textSearch">Search for a Purchase</label>
<br/>
<input type="text" name="textSearch" id="textSearch" placeholder="Enter a search value">
<button value="Search" onclick="searchForText(this.previousElementSibling);">Search</button>
<div id="textSearchResponseBox" name="textSearchResponseBox"/>
<hr>

<form method="post" action="/purchases/2">

    <input type="text" name="test" id="test" value="Amanda"/>

    <button type="submit" value="Submit">Submit</button>

</form>


</body>
</html>